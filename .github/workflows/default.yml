name: Dotfiles Management - Foundation Testing
on:
  push:
    branches:
      - main
  # Allow manual triggering for testing
  workflow_dispatch:
jobs:
  foundation-validation:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          ref: main
      - name: Install GNU Stow
        run: sudo apt-get update && sudo apt-get install -y stow
      - name: Foundational Checks
        run: |
          make check-tools
          make check-root
      - name: Verify deployment would succeed - dry-run conflict check
        run: make verify
      - name: valdate dotfile deployment and initialization
        run: |
          make init
          dot-local/bin/validate-init
          make default
          dot-local/bin/validate-stow

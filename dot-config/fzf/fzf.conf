# FZF generic config for XDG environment, suitable for ptyxis and other terminals
# Only run FZF config if inside a Toolbox container

if [ -f "/run/.toolboxenv" ]; then

  # Set FZF default options
  export FZF_DEFAULT_OPTS="
    --height=85%
    --layout=reverse
    --border
    --margin=1,2
    --info=inline
    --prompt='❯ '
    --pointer='▶'
    --marker='✓'
    --color=bg+:#1e222a,fg+:#c8ccd4,prompt:#7aa2f7,spinner:#f7768e,hl:#bb9af7,fg:#c8ccd4,bg:#24283b
  "

  # Use bat for preview if available
  if command -v bat > /dev/null; then
    export FZF_DEFAULT_COMMAND="fd --type f --hidden --follow --exclude .git"
    export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
    export FZF_CTRL_T_OPTS="--preview 'bat --style=numbers --color=always {} | head -100'"
  else
    export FZF_DEFAULT_COMMAND="find . -type f"
    export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
    export FZF_CTRL_T_OPTS="--preview 'head -100 {}'"
  fi

  # Enable preview window for fzf
  export FZF_PREVIEW_OPTS="--preview-window=right:60%:wrap"

  # Key bindings for FZF (works in most shells, including bash/zsh/fish)
  export FZF_TMUX=1
  export FZF_COMPLETION_TRIGGER='**'

  # For ptyxis: set TERM to xterm-256color for optimal colors
  export TERM="xterm-256color"

  # Ptyxis-specific: detect ptyxis and adjust FZF opacity for better integration if supported
  if [ "$TERM_PROGRAM" = "ptyxis" ]; then
    # If FZF is run in ptyxis, set a semi-transparent background (if supported)
    export FZF_DEFAULT_OPTS="$FZF_DEFAULT_OPTS --color=bg:#24283b,preview-bg:#24283b@70"
  fi

fi
